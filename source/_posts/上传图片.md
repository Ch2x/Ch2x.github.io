---
title: 上传图片
date: 2019-12-05 22:05:31
tags:
---

# 上传多张图片

## 添加页面标签元素

```html
<input
    type="file"
    :multiple="multiple"
    accept="image/*"
    @change="handleChang"
/>
```

## 获取图片文件

```js
handleInputChange(event) {
    const files = event.currentTarget.files,
        maxSize = 10 * 1024 * 1024; //10M

    for(let i =0, len = files.length; i++) {
        if (file.size > maxSize) {
            console.log("仅支持小于10M的图片");
        } else {
            //执行图片的处理
        }
    }
}
```

## 处理图片base64

```js
handleFile(file) {
    const reader = new FileReader(); //新建一个FileReader对象
    reader.onload = function (event)) {
        const img = new Image();

        img.onload = function() {
            // 处理图片
            // 1、拍照在IOS7或以下的机型会出现照片被压扁的bug
            // 2、获取图片的orientation
            // 3、修正拍照时图片的方向
            // 压缩图片
            // 上传服务器
        }

        img.src = evt.target.result; //得到URL格式的字符串（base64编码）以表示所读取文件的内容
    };
    reader.readAsDataURL(file);

```

## 使用canvas压缩图片

```js
const canvas = document.createElement('canvas'),
            ctx = canvas.getContext('2d');
    if (w < h && h > maxH) {
        w = parseInt(maxH * img.width / img.height);
        h = maxH;
    } else if (w >= h && w > maxW) {
        h = parseInt(maxW * img.height / img.width);
        w = maxW;
    }
    canvas.width = w;
    canvas.height = h;
    ctx.drawImage(img, 0, 0, w, h);
    canvas.toDataURL('image/jpeg', .8); //压缩率
```
